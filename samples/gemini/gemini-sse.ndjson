//exmplae1:
data: {"nonce": "749ff25beb", "candidates": [{"content": {"parts": [{"text": "**Verifying Initial St*any* type.\n\n\n","thought": true}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 20932,"totalTokenCount": 20932,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 20932}]},"modelVersion": "gemini-3-flash-preview","responseId": "hvyDacbXC5OFz7IPs7mb4Ak"}

data: {"nonce": "3fa8", "candidates": [{"content": {"parts": [{"functionCall": {"name": "grep","args": {"pattern": "judgeGeminiRequest"}},"thoughtSignature": "EtQGCtEGAb4+9vtJqKCEnlpSaBMmv/CAq8SsrKq8so21v6HhNii55m8fmRT6GWJBr"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 20932,"candidatesTokenCount": 17,"totalTokenCount": 21134,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 20932}],"thoughtsTokenCount": 185},"modelVersion": "gemini-3-flash-preview","responseId": "hvyDacbXC5OFz7IPs7mb4Ak"}

data: {"nonce": "fd8684c1f8", "candidates": [{"content": {"parts": [{"text": ""}],"role": "model"},"finishReason": "STOP","index": 0}],"usageMetadata": {"promptTokenCount": 24747,"candidatesTokenCount": 17,"totalTokenCount": 24949,"cachedContentTokenCount": 17332,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 24747}],"cacheTokensDetails": [{"modality": "TEXT","tokenCount": 17332}],"thoughtsTokenCount": 185},"modelVersion": "gemini-3-flash-preview","responseId": "hvyDacbXC5OFz7IPs7mb4Ak"}



//exmample2:
data: {"nonce": "bbffd4", "candidates": [{"content": {"parts": [{"text": "**Confn","thought": true}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"totalTokenCount": 16438,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}]},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "1eda0ec0abf2a3", "candidates": [{"content": {"parts": [{"text": "**Refining responses containing `candidates`.\n\n\n","thought": true}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"totalTokenCount": 16438,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}]},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "dbf16617222e", "candidates": [{"content": {"parts": [{"text": "I've updated `isGeminiPath` to be more inclusive and modified `isGeminiReq"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 21,"totalTokenCount": 17054,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "ea78c59608", "candidates": [{"content": {"parts": [{"text": "` and `isGeminiRes` to detect Gemini requests based on their body structure, even if they use non-standard"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 46,"totalTokenCount": 17079,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "78cfd7ff961157", "candidates": [{"content": {"parts": [{"text": " or proxied endpoints.\n\n```typescript\n\u003c\u003c\u003c\u003c\nfunction isGeminiPath(flow: Flow): boolean {\n"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 70,"totalTokenCount": 17103,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "e2d23368f94709ac", "candidates": [{"content": {"parts": [{"text": "  const path = flow.request.path\n  // 识别 generateContent 或 streamGenerateContent\n  return path"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 94,"totalTokenCount": 17127,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "76", "candidates": [{"content": {"parts": [{"text": ".includes(':generateContent') || path.includes(':streamGenerateContent')\n}\n\nexport function isGeminiReq"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 118,"totalTokenCount": 17151,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "1316738af16ae0", "candidates": [{"content": {"parts": [{"text": "(action: 'request' | 'response', data: any, flow: Flow): boolean {\n  if ("}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 142,"totalTokenCount": 17175,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "ec171df6f8fabe", "candidates": [{"content": {"parts": [{"text": "action !== 'request' || !isGeminiPath(flow)) return false\n  const body = parseDataText"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 166,"totalTokenCount": 17199,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "d9a297", "candidates": [{"content": {"parts": [{"text": "(data)\n  // Gemini 请求体包含 contents 数组\n  return body && Array.isArray(body."}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 190,"totalTokenCount": 17223,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "69336ec6b1", "candidates": [{"content": {"parts": [{"text": "contents)\n}\n\nexport function isGeminiRes(action: 'request' | 'response', data: any"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 214,"totalTokenCount": 17247,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "22cfbe5535", "candidates": [{"content": {"parts": [{"text": ", flow: Flow): boolean {\n  if (action !== 'response' || !isGeminiPath(flow"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 238,"totalTokenCount": 17271,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "1c6a90dbf167", "candidates": [{"content": {"parts": [{"text": ")) return false\n  // Gemini 流式响应通常也是 application/json (Chunked) 或者 SSE，视具体"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 262,"totalTokenCount": 17295,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "dcce", "candidates": [{"content": {"parts": [{"text": "客户端实现而定\n  // 但原生 API 返回的是 JSON 数组或连续的 JSON 对象\n  if ("}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 286,"totalTokenCount": 17319,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "b59a3786948c", "candidates": [{"content": {"parts": [{"text": "isJson(flow)) {\n    const body = parseDataText(data)\n    // Gemini 响应包含"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 310,"totalTokenCount": 17343,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "9c245b", "candidates": [{"content": {"parts": [{"text": " candidates\n    return body && (Array.isArray(body.candidates) || (Array.isArray(body) &&"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 334,"totalTokenCount": 17367,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "0605", "candidates": [{"content": {"parts": [{"text": " body[0]?.candidates))\n  }\n  return false\n}\n====\nfunction isGeminiPath("}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 358,"totalTokenCount": 17391,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "f8cd93c493", "candidates": [{"content": {"parts": [{"text": "flow: Flow): boolean {\n  const path = flow.request.path.toLowerCase()\n  // 识别"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 382,"totalTokenCount": 17415,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "874bc3262210", "candidates": [{"content": {"parts": [{"text": " generateContent 或 streamGenerateContent, 或者包含 gemini 关键字的路径\n  return path.includes(':generatecontent') ||"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 408,"totalTokenCount": 17441,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "47554b02", "candidates": [{"content": {"parts": [{"text": " \n         path.includes(':streamgeneratecontent') || \n         path.includes('gemini')\n}"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 432,"totalTokenCount": 17465,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "0623484f227b", "candidates": [{"content": {"parts": [{"text": "\n\nexport function isGeminiReq(action: 'request' | 'response', data: any, flow: Flow"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 456,"totalTokenCount": 17489,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "a371", "candidates": [{"content": {"parts": [{"text": "): boolean {\n  if (action !== 'request') return false\n  const body = parseDataText(data"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 480,"totalTokenCount": 17513,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "a3e05271f0", "candidates": [{"content": {"parts": [{"text": ")\n  if (!body) return false\n\n  // Gemini 请求体特征：包含 contents 数组，且元素"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 504,"totalTokenCount": 17537,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "cf92724f", "candidates": [{"content": {"parts": [{"text": "通常包含 parts\n  const hasGeminiStructure = Array.isArray(body.contents) && \n    (body.contents"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 531,"totalTokenCount": 17564,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "060a300b6c79ba", "candidates": [{"content": {"parts": [{"text": ".length === 0 || body.contents.some((c: any) =\u003e c && (c.parts ||"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 555,"totalTokenCount": 17588,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "ac77c1fe9ced", "candidates": [{"content": {"parts": [{"text": " c.role)))\n\n  return isGeminiPath(flow) || hasGeminiStructure\n}\n\nexport function"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 579,"totalTokenCount": 17612,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "b0", "candidates": [{"content": {"parts": [{"text": " isGeminiRes(action: 'request' | 'response', data: any, flow: Flow): boolean {"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 603,"totalTokenCount": 17636,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "1b", "candidates": [{"content": {"parts": [{"text": "\n  if (action !== 'response') return false\n  \n  const body = parseDataText(data)"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 627,"totalTokenCount": 17660,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "f0f03a9a7d", "candidates": [{"content": {"parts": [{"text": "\n  if (!body) return false\n\n  // Gemini 响应体特征：包含 candidates 数组\n  const hasCandidates ="}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 654,"totalTokenCount": 17687,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "d3b0d2e9", "candidates": [{"content": {"parts": [{"text": " (b: any) =\u003e {\n    if (Array.isArray(b)) return b.some(item =\u003e"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 678,"totalTokenCount": 17711,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "99", "candidates": [{"content": {"parts": [{"text": " item && item.candidates)\n    return b && b.candidates\n  }\n\n  return isGeminiPath"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 702,"totalTokenCount": 17735,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "20c7727f", "candidates": [{"content": {"parts": [{"text": "(flow) || hasCandidates(body)\n}\n\u003e\u003e\u003e\u003e\n"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 716,"totalTokenCount": 17749,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "bf2cd0a364f445", "candidates": [{"content": {"parts": [{"text": "```"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 717,"totalTokenCount": 17750,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "fa6b", "candidates": [{"content": {"parts": [{"functionCall": {"name": "edit","args": {"oldString": "function isGeminiPath(flow: Flow): boolean {\n  const path = flow.re","newString": "function isGeminiPath(flow: Flow): boolean {\n  const path = flow.request.path.toLowerCase()\n  // 识别 generateContent 或 streamGenerateContent, 或者包含 gemini 关键字的路径\n  return path.includes(':generatecontent') |)\n}"}},"thoughtSignature": "g=="}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 16438,"candidatesTokenCount": 1428,"totalTokenCount": 18461,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 16438}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}

data: {"nonce": "b8d24e09ba44", "candidates": [{"content": {"parts": [{"text": ""}],"role": "model"},"finishReason": "STOP","index": 0}],"usageMetadata": {"promptTokenCount": 19346,"candidatesTokenCount": 1428,"totalTokenCount": 21369,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 19346}],"thoughtsTokenCount": 595},"modelVersion": "gemini-3-flash-preview","responseId": "afyDaZb0Mofqz7IPx-Do0Qw"}


